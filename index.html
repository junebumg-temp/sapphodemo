<!DOCTYPE html>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VS Code Setup</title>
    <link rel="stylesheet" href="Styles.css">
    <script src="https://d3js.org/d3.v7.min.js"></script>
</head>
<body>

<!--Way too much audio-->
<audio preload="auto" id="As1"><source src="As1.mp3" type="audio/mp3"></source></audio>
<audio preload="auto" id="As2"><source src="As2.mp3" type="audio/mp3"></source></audio>
<audio preload="auto" id="As3"><source src="As3.mp3" type="audio/mp3"></source></audio>

<audio preload="auto" id="A1"><source src="A1.mp3" type="audio/mp3"></source></audio>
<audio preload="auto" id="A2"><source src="A2.mp3" type="audio/mp3"></source></audio>
<audio preload="auto" id="A3"><source src="A3.mp3" type="audio/mp3"></source></audio>

<audio preload="auto" id="B1"><source src="B1.mp3" type="audio/mp3"></source></audio>
<audio preload="auto" id="B2"><source src="B2.mp3" type="audio/mp3"></source></audio>
<audio preload="auto" id="B3"><source src="B3.mp3" type="audio/mp3"></source></audio>

<audio preload="auto" id="C1"><source src="C1.mp3" type="audio/mp3"></source></audio>
<audio preload="auto" id="C2"><source src="C2.mp3" type="audio/mp3"></source></audio>
<audio preload="auto" id="C3"><source src="C3.mp3" type="audio/mp3"></source></audio>
<audio preload="auto" id="C4"><source src="C4.mp3" type="audio/mp3"></source></audio>

<audio preload="auto" id="Ds1"><source src="Ds1.mp3" type="audio/mp3"></source></audio>
<audio preload="auto" id="Ds2"><source src="Ds2.mp3" type="audio/mp3"></source></audio>

<audio preload="auto" id="D1"><source src="D1.mp3" type="audio/mp3"></source></audio>
<audio preload="auto" id="D2"><source src="D2.mp3" type="audio/mp3"></source></audio>
<audio preload="auto" id="D3"><source src="D3.mp3" type="audio/mp3"></source></audio>

<audio preload="auto" id="E1"><source src="E1.mp3" type="audio/mp3"></source></audio>
<audio preload="auto" id="E2"><source src="E2.mp3" type="audio/mp3"></source></audio>
<audio preload="auto" id="E3"><source src="E3.mp3" type="audio/mp3"></source></audio>

<audio preload="auto" id="Fs1"><source src="Fs1.mp3" type="audio/mp3"></source></audio>
<audio preload="auto" id="Fs2"><source src="Fs2.mp3" type="audio/mp3"></source></audio>
<audio preload="auto" id="Fs3"><source src="Fs3.mp3" type="audio/mp3"></source></audio>

<audio preload="auto" id="F1"><source src="F1.mp3" type="audio/mp3"></source></audio>
<audio preload="auto" id="F2"><source src="F2.mp3" type="audio/mp3"></source></audio>
<audio preload="auto" id="F3"><source src="F3.mp3" type="audio/mp3"></source></audio>

<audio preload="auto" id="G1"><source src="G1.mp3" type="audio/mp3"></source></audio>
<audio preload="auto" id="G2"><source src="G2.mp3" type="audio/mp3"></source></audio>
<audio preload="auto" id="G3"><source src="G3.mp3" type="audio/mp3"></source></audio>




<svg id="d3-overlay"></svg>
  
<section>
<h2>
    Sappho Fragment 31
</h2>
<p class = "hovertext"> 
    <!--Stanza 1-->
        <!--Line 1-->
        <span class="d3-trigger" data-bubbles='["PHAINETAI", "It seems", "Seems", "He seems", "I set", "Look", "Syn"]' sound='D1'> It appears</span>
        <span class="d3-trigger" data-bubbles='["MOI", "I", "speaker", "observer"]' sound='Fs1'> to me</span>
        <span class="d3-trigger" data-bubbles='["KENOS", "that man", "he"]' sound='A1'> that</span>
        <span class="d3-trigger" data-bubbles='["ISOS", "equal", "has", "more happy", "peer"]' sound='D2'> just like</span>
        <span class="d3-trigger" data-bubbles='["THEOISIN", "the gods", "blessed", "fortunate", "immortal"]' sound='Fs2'> a god</span>
        <br><!--Line 2-->
        <span class="d3-trigger" data-bubbles='["EMMEN", "to be", "now"]' sound='E1'> is</span>
        <span class="d3-trigger" data-bubbles='["ONER", "man", "anyone", "someone"]' sound='G1'> he,</span>
        <span class="d3-trigger" data-bubbles='["OTTIS", "who", "anybody"]' sound='B1'> anyone</span>
        <span class="d3-trigger" data-bubbles='["ENANTIOS", "beside", "across from", "opposite", "nearby"]' sound='E2'> next to</span>
        <span class="d3-trigger" data-bubbles='["TOI", "you", "thee", "thy"]' sound='G2'> you</span>
        <br><!--Line 3-->
        <span class="d3-trigger" data-bubbles='["ISDANEI", "sits", "reclining"]' sound='G1'>Sitting</span>
        <span class="d3-trigger" data-bubbles='["KAI"]' sound='B1'> and</span>
        <span class="d3-trigger" data-bubbles='["PLASION", "nearby", "around", "just by"]' sound='D1'> so close to</span>
        <span class="d3-trigger" data-bubbles='["ADU", "sweet", "carming", "dimpled"]' sound='G2'> honeysweet</span>
        <span class="d3-trigger" data-bubbles='["PHONEI-", "talk", "words", "mouth"]' sound='B2'> speech</span>
        <br><!--Line 4-->
        <span class="d3-trigger" data-bubbles='["-SAS", "-ing"]' sound='D2'>&emsp14;&emsp14;&emsp14; -crafting</span>
        <span class="d3-trigger" data-bubbles='["UPAKOUEI", "listens", "hears", "senses", "observes", "so close"]' sound='Fs2'> harks</span>
   
    <br><br><!--Stanza 2-->
       <!--Line 1-->
        <span class="d3-trigger" data-bubbles='["KAI"]' sound='D1'>And</span>
        <span class="d3-trigger" data-bubbles='["GELAISAS", "laughing", "giggling"]' sound='Fs1'> giggling</span>
        <span class="d3-trigger" data-bubbles='["IMEROEN", "tempting", "lovely", "sweet"]' sound='A1'> invitations</span>
        <span class="d3-trigger" data-bubbles='["TO"]' sound='D2'> that</span>
        <span class="d3-trigger" data-bubbles='["M", "me", "I"]' sound='Fs2'> my</span>
        <span class="d3-trigger" data-bubbles='["E"]' sound='A2'> [oh</span>
        <span class="d3-trigger" data-bubbles='["MAN", "for sure", "surely"]' sound='D3'> my]</span>
        <br><!--Line 2-->
        <span class="d3-trigger" data-bubbles='["KARDIAN", "within", "beating"]' sound='A1'>Heart</span>
        <span class="d3-trigger" data-bubbles='["EN", "inside", "within"]' sound='C2'> in</span>
        <span class="d3-trigger" data-bubbles='["STETHESIN", "my breast", "my chest", "within me"]' sound='E1'> its cage</span>
        <span class="d3-trigger" data-bubbles='["EEPTOAISEN;", "fluttering", "on wings", "ravished"]' sound='A2'> runs aflutter.</span>
        <br><!--Line 3-->
        <span class="d3-trigger" data-bubbles='["OS", "Now", "whenever"]' sound='G1'>When</span>
        <span class="d3-trigger" data-bubbles='["GAR", "you", "thee", "at"]' sound='B1'> for you</span>
        <span class="d3-trigger" data-bubbles='["ES", "towards", "for"]' sound='D1'> at </span>
        <span class="d3-trigger" data-bubbles='["S", "you", "you", "you"]' sound='G2'> you</span>
        <span class="d3-trigger" data-bubbles='["IDO", "glance", "gaze"]' sound='B2'> I look</span>
        <span class="d3-trigger" data-bubbles='["BROCHE", "even quickly", "a moment"]' sound='D2'>, even a pass,</span>
        <span class="d3-trigger" data-bubbles='["OS", "now", "then"]' sound='G3'> when</span>
        <span class="d3-trigger" data-bubbles='["ME", "I", "me"]' sound='B3'> my</span>
        <span class="d3-trigger" data-bubbles='["PHONAI-", "talk", "words", "mouth"]' sound='D3'> speech</span>
        <br><!--Line 4-->
        <span class="d3-trigger" data-bubbles='["-S", "ing"]' sound='E1'>&emsp14;&emsp14;&emsp14; -work -</span>
        <span class="d3-trigger" data-bubbles='["OUD", "not", "no"]' sound='G1'> im</span>
        <span class="d3-trigger" data-bubbles='["IN", "capable"]' sound='B1'>possible -</span>
        <span class="d3-trigger" data-bubbles='["ET", "no more", "nothing"]' sound='E2'> nothing more -</span>
        <span class="d3-trigger" data-bubbles='["EIKEI", "can happen", "silence"]' sound='G2'> is possible</span>

    <br><br><!--Stanza 3-->
        <!--Line 1-->
        <span class="d3-trigger" data-bubbles='["ALLA", "only", "but", "no:"]' sound='D1'>Just</span>
        <span class="d3-trigger" data-bubbles='["KAM-MEN", "rather"]' sound='F1'> instead</span>
        <span class="d3-trigger" data-bubbles='["GLOSSA", "mouth", "voice", "self"]' sound='A1'> a tongue</span>
        <span class="d3-trigger" data-bubbles='["[M]", "me"]' sound='D2'> [my]</span>
        <span class="d3-trigger" data-bubbles='["EAGE", "mute", "shattered", "destroyed", "silent", "breaks", "useless", "mortal", "lost"]' sound='F2'> is broken -</span>
        <span class="d3-trigger" data-bubbles='["lepton", "thin", "delicate"]' sound='A2'> a slight</span>
        <br><!--Line 2-->
        <span class="d3-trigger" data-bubbles='["D", "only", "mere"]' sound='A1'>but</span>
        <span class="d3-trigger" data-bubbles='["AUTIKA", "immediately", "suddenly"]' sound='C1'> a snap -</span>
        <span class="d3-trigger" data-bubbles='["CHRO", "it", "the body", "flesh"]' sound='E1'> the skin,</span>
        <span class="d3-trigger" data-bubbles='["PUR", "a heat", "a burning"]' sound='A2'> the fire -</span>
        <span class="d3-trigger" data-bubbles='["UPDEDROMEKEN", "running", "racing", "beating"]' sound='C2'> rushing under</span>
        <br><!--Line 3-->
        <span class="d3-trigger" data-bubbles='["OPPATESSI", "eyes", "seeing"]' sound='E1'>- the eyes</span>
        <span class="d3-trigger" data-bubbles='["D"]' sound='G1'> and -</span>
        <span class="d3-trigger" data-bubbles='["OUD", "nothing", "non"]' sound='B1'> with</span>
        <span class="d3-trigger" data-bubbles='["EN", "having", "giving"]' sound='E2'>out</span>
        <span class="d3-trigger" data-bubbles='["OREMM", "vision", "seeing", "light"]' sound='G2'> sight -</span>
        <span class="d3-trigger" data-bubbles='["EPIRROM-", "drumming", "roaring", "humming"]' sound='B2'> surrurant</span>
        <br><!--Line 4-->
        <span class="d3-trigger" data-bubbles='["-BEISI", "ing", "ing"]' sound='G1'>&emsp14;&emsp14;&emsp14;rumble</span>
        <span class="d3-trigger" data-bubbles='["D"]' sound='As1'> and -</span>
        <span class="d3-trigger" data-bubbles='["AUKOUAI", "in my ears", "hearing"]' sound='D1'> the ears -</span>
    <br><br><!--Stanza 4-->
        <!--Line 1-->
        <span class="d3-trigger" data-bubbles='["KAD", "and", "so"]' sound='D2'>Over</span>
        <span class="d3-trigger" data-bubbles='["DE", "and", "so"]' sound='Fs2'> and - over</span>
        <span class="d3-trigger" data-bubbles='["M", "I"]' sound='A2'> me</span>
        <span class="d3-trigger" data-bubbles='["IDROS", "cold"]' sound='D3'> sweat</span>
        <span class="d3-trigger" data-bubbles='["KAKCHEETAI", "all over"]' sound='Fs3'> pouring -</span>
        <span class="d3-trigger" data-bubbles='["TROMOS", "trembling", "quaking", "shaking"]' sound='A3'> shivering</span>
        <span class="d3-trigger" data-bubbles='["DE"]' sound='Fs2'> and</span>
        <br><!--Line 2-->
        <span class="d3-trigger" data-bubbles='["PAISAN", "the body", "me all"]' sound='B2'>The whole thing</span>
        <span class="d3-trigger" data-bubbles='["AGREI", "seizes"]' sound='Ds1'> gripping -</span>
        <span class="d3-trigger" data-bubbles='["CHLOROTERA", "greener than"]' sound='Fs2'> greening</span>
        <span class="d3-trigger" data-bubbles='["DE"]' sound='A3'> and - </span>
        <span class="d3-trigger" data-bubbles='["POIAS", "the grass", "the flowers"]' sound='B3'> beyond grass</span>
        <br><!--Line 3-->
        <span class="d3-trigger" data-bubbles='["EMMI", "I", "me"]' sound='E1'>- I am -</span>
        <span class="d3-trigger" data-bubbles='["TETHNAKEN", "die", "am dead"]' sound='G1'> dead</span>
        <span class="d3-trigger" data-bubbles='["D", "but"]' sound='B1'> or -</span>
        <span class="d3-trigger" data-bubbles='["OLIGO", "or almost"]' sound='E2'> just a step</span>
        <span class="d3-trigger" data-bubbles='["PIDEUES", "needing little but"]' sound='B2'> short of it -</span>
        <br><!--Line 4-->
        <span class="d3-trigger" data-bubbles='["PHAINOM", "I appear"]' sound='D2'>&emsp14;&emsp14;&emsp14;I seem</span>
        <span class="d3-trigger" data-bubbles='["EM"]' sound='Fs2'> to</span>
        <span class="d3-trigger" data-bubbles='["AUTA", "me", "I"]' sound='A2'> myself</span>
    
    <br><br><!--Stanza 5 - one line-->
        <span class="d3-trigger" data-bubbles='["ALLA", "Yet", "Still"]' sound='B1'>But</span>
        <span class="d3-trigger" data-bubbles='["PAM", "all", "the worst"]' sound='Ds1'> anything</span>
        <span class="d3-trigger" data-bubbles='["TOLMATION", "risk", "endure","bear"]' sound='Fs2'> I must dare it</span>
        <span class="d3-trigger" data-bubbles='["EPEI", "because"]' sound='A2'> since </span>

         [<span class="d3-trigger" data-bubbles='["KAI"]' sound='B3'>even</span>
        <span class="d3-trigger" data-bubbles='["PENTA", "pauper", "so sad"]' sound='Ds2'> so poor a woman</span>
        <span class="d3-trigger" data-bubbles='["...", "loss", "missing"]' sound='Fs2'> ...</span>]
</p>
</section>


<!-- Script for bubble behavors -->
<script>  

 const svg = d3.select("#d3-overlay");

/* Setup Simulation with d3 */
const simulation = d3.forceSimulation()
    .force("link", d3.forceLink().id(d => d.id).distance(100))
    .force("charge", d3.forceManyBody().strength(-300))
    .force("collide", d3.forceCollide(40))
    .on("tick", ticked);

/* Initializations */
let nodes = [];
let links = [];



/* Hover Behaviour (Tracks Mouse Events) */
document.querySelectorAll('.d3-trigger').forEach(trigger => {
    trigger.addEventListener('mouseenter', (e) => {
        simulation.stop();

        const note = e.target.getAttribute('sound')
        const audio = document.getElementById(note);

        audio.currentTime = 0;
        audio.play();

        // Get the labels from data-bubbles
        // Provide a fallback empty array if the attribute is missing
        const labelData = e.target.getAttribute('data-bubbles');
        const labels = labelData ? JSON.parse(labelData) : ["Default"];


        const rect = e.target.getBoundingClientRect();
        const cx = rect.left + rect.width / 2;
        const cy = rect.top + rect.height / 2;

        const anchor = { id: 'anchor', x: cx, y: cy, fx: cx, fy: cy };
        
        // Create nodes based on the labels
        const newNodes = labels.map((l, i) => ({ 
            id: `bubble-${i}`, // Unique ID
            label: l, 
            x: cx, 
            y: cy,
            vx: 0, 
            vy: 0 
        }));

        // Calls Update
        nodes = [anchor, ...newNodes];
        links = newNodes.map(n => ({ source: 'anchor', target: n.id }));
        update();
    });

    // When you hover off, these things disappear
    trigger.addEventListener('mouseleave', () => {
        nodes = [];
        links = [];
        update();
    });
});

/* Creates the visual structure from the data in the variables */
function update() {
    const link = svg.selectAll(".link-line").data(links);
    link.exit().remove();
    const linkEnter = link.enter().append("line").attr("class", "link-line").style("opacity", 0);
    linkEnter
        .transition()
        .duration(400)
        .style("opacity", 0.6)
        .style("stroke", "#E6D81C");

    const nodeGroups = svg.selectAll(".node-group").data(nodes, d => d.id);
    nodeGroups.exit().remove();

    const enterGroups = nodeGroups.enter().append("g").attr("class", "node-group");

 const bubbles = enterGroups.filter(d => d.id !== 'anchor');

            bubbles.append("rect")
                .attr("rx", 8).attr("ry", 8)
                .attr("fill", "#E6D81C")
                .attr("width", d => (d.label.length * 12) + 20) // Dynamic width logic
                .attr("height", 34)
                .attr("x", d => -((d.label.length * 12) + 20) / 2) // Center logic
                .attr("y", -17)
                .style("opacity", 0)
                .transition().duration(400).ease(d3.easeBackOut).style("opacity", .5);

            bubbles.append("text")
                .attr("class", "node-text")
                .attr("text-anchor", "middle")
                .attr("dy", ".35em")
                .style("fill", "#600000")
                .style("text-shadow", "1px 1px 0px #000000, 2px 2px 2px #ffffff")
                .text(d => d.label)
                .style("opacity", 0)
                .style("font-size", 20)
                .transition().delay(200).style("opacity", 1);
 

    // Re-bind and restart the physics (idk why this works)
    simulation.nodes(nodes);
    simulation.force("link").links(links);
    
    // Fly out from the center
    simulation.alpha(1).restart();
}

/* Continuous and Smooth Motion */
function ticked() {
    // This physically moves the lines and circles
    svg.selectAll(".link-line")
        .attr("x1", d => d.source.x).attr("y1", d => d.source.y)
        .attr("x2", d => d.target.x).attr("y2", d => d.target.y);

    svg.selectAll(".node-group")
        .attr("transform", d => `translate(${d.x || 0},${d.y || 0})`);
}

</script>

</body>
</html>
